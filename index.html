<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <title>Paper Ball Adventure: The Cake Hunt</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/matter-js/0.19.0/matter.min.js"></script>
    <style>
        body { margin: 0; overflow: hidden; background: #eee; font-family: 'Comic Sans MS', cursive; }
        canvas { background: #fff url('https://www.toptal.com/designers/subtlepatterns/patterns/paper.png'); }
        #menu {
            position: absolute; width: 100%; height: 100%; background: white;
            display: flex; flex-direction: column; align-items: center; justify-content: center; z-index: 100;
        }
        #ui { position: absolute; top: 20px; left: 20px; pointer-events: none; background: rgba(255,255,255,0.8); padding: 10px; border: 2px solid #000; }
        .btn { padding: 10px 20px; font-size: 20px; cursor: pointer; border: 2px solid #000; background: #fff; transition: 0.2s; }
        .btn:hover { background: #000; color: #fff; }
    </style>
</head>
<body>

<div id="menu">
    <h1>–í–´–ë–ï–†–ò –£–†–û–í–ï–ù–¨</h1>
    <button class="btn" onclick="startLevel(1)">–£–†–û–í–ï–ù–¨ 1: –ì–†–ê–í–ò–¢–ê–¶–ò–Ø</button>
</div>

<div id="ui" style="display:none">
    <h2 style="margin:0">–£—Ä–æ–≤–µ–Ω—å 1: –ö —Ç–æ—Ä—Ç–∏–∫—É! üç∞</h2>
    <p>–ù–∞—Ä–∏—Å—É–π –º–æ—Å—Ç—ã –∏ –Ω–∞–ø—Ä–∞–≤–ª—è—é—â–∏–µ, —á—Ç–æ–±—ã —à–∞—Ä–∏–∫ —Å–∫–∞—Ç–∏–ª—Å—è –≤–Ω–∏–∑.</p>
</div>

<script>
const { Engine, Render, Runner, World, Bodies, Events } = Matter;

let engine, render, ball, cake;

function startLevel(id) {
    document.getElementById('menu').style.display = 'none';
    document.getElementById('ui').style.display = 'block';
    
    engine = Engine.create();
    render = Render.create({
        element: document.body,
        engine: engine,
        options: { width: window.innerWidth, height: window.innerHeight, wireframes: false, background: 'transparent' }
    });

    // –ü–ª–∞—Ç—Ñ–æ—Ä–º—ã —Å–≤–µ—Ä—Ö—É –≤–Ω–∏–∑ (—Å –ø–µ—Ä–µ–∫—Ä—ã—Ç–∏–µ–º)
    const p1 = Bodies.rectangle(1100, 200, 400, 20, { isStatic: true, render: { fillStyle: '#333' } }); // –°—Ç–∞—Ä—Ç
    const p2 = Bodies.rectangle(650, 450, 600, 20, { isStatic: true, angle: 0.4, render: { fillStyle: '#333' } }); // –°–ø—É—Å–∫
    const p3 = Bodies.rectangle(200, 650, 400, 20, { isStatic: true, render: { fillStyle: '#333' } }); // –§–∏–Ω–∏—à

    ball = Bodies.circle(1200, 150, 25, {
        restitution: 0.4, friction: 0.005,
        render: { sprite: { texture: 'https://cdn-icons-png.flaticon.com/512/742/742751.png', xScale: 0.1, yScale: 0.1 } }
    });

    cake = Bodies.rectangle(150, 600, 60, 60, {
        isStatic: true, isSensor: true,
        render: { sprite: { texture: 'https://cdn-icons-png.flaticon.com/512/2682/2682435.png', xScale: 0.12, yScale: 0.12 } }
    });

    World.add(engine.world, [p1, p2, p3, ball, cake]);

    // –†–∏—Å–æ–≤–∞–Ω–∏–µ —Å–µ–≥–º–µ–Ω—Ç–∞–º–∏ (–Ω–µ –≤—ã–ø—Ä—è–º–ª—è–µ—Ç—Å—è)
    let isDrawing = false;
    let lastPoint = null;

    window.addEventListener('mousedown', (e) => { isDrawing = true; lastPoint = { x: e.clientX, y: e.clientY }; });
    window.addEventListener('mouseup', () => isDrawing = false);
    window.addEventListener('mousemove', (e) => {
        if (!isDrawing) return;
        let current = { x: e.clientX, y: e.clientY };
        let d = Math.hypot(current.x - lastPoint.x, current.y - lastPoint.y);
        
        if (d > 10) {
            let mid = { x: (current.x + lastPoint.x)/2, y: (current.y + lastPoint.y)/2 };
            let angle = Math.atan2(current.y - lastPoint.y, current.x - lastPoint.x);
            let segment = Bodies.rectangle(mid.x, mid.y, d + 2, 6, {
                angle: angle,
                render: { fillStyle: 'black' }
            });
            World.add(engine.world, segment);
            lastPoint = current;
        }
    });

    Events.on(engine, 'collisionStart', (e) => {
        e.pairs.forEach(p => {
            if ((p.bodyA === ball && p.bodyB === cake) || (p.bodyB === ball && p.bodyA === cake)) {
                ball.force = { x: 0, y: -0.1 }; // –ü—Ä—ã–∂–æ–∫
                setTimeout(() => { alert("–í–ö–£–°–ù–û! üç∞"); location.reload(); }, 500);
            }
        });
    });

    Render.run(render);
    Runner.run(Runner.create(), engine);
}
</script>
</body>
</html>